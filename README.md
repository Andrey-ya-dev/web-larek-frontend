# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с TS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Основные типы данных в проeкте реализованы в папке `types/index.ts`.

Данные получаемые при загрузке списка товара с сервера\
Находится в файле `src/components/base/api`

```
type ApiListResponse<Type> = {
	total: number;
	items: Type[];
}
```

Интерфейс для модели данных товара

```
interface IProductItem {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number;
}
```

Интерфейс для модели данных заказа

```
interface IOrder {
	payment: TPaymentOption;
	email: string;
	phone: string;
	address: string;
	total: number;
	items: string[];
}
```

Данные корзины

```
type TBasket = Pick<IOrder, 'items' | 'total'>
```

Имена полей в которые вводятся данные пользователем

```
type TOrderField = 'address' | 'phone' | 'email';
```

Данные товара используемые в корзине

```
type TProductInBasket = Pick<IProductItem, 'id' | 'title' | 'price'>;
```

Данные товар используемые в каталоге

```
type TProductInCatalog = Omit<IProductItem, 'description'>;
```

Данные выбора способа оплаты

```
type TPaymentOption = 'card' | 'cash' | '';
```

Интерфейс ответа сервера при успешно заказе

```
interface IOrderSuccess {
	id: string;
	total: number;
}
```

Интерфейс ответа сервера при возникновение ошибки

```
interface ErrorMessage {
	error: string;
}
```

## Архитектура проекта (MVP)

Архитектурой проекта выбран патерн `MV`, его вариант `MVP`.

Код приложения разделен на слои согласно парадигме:

- слой представления(Отображение/View), отвечает за отображение данных на странице,
- слой данных(Модель/Model), отвечает за хранение и изменение данных
- презентер(Презентер/Presenter), отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Модель / Model данных / Слой данных

Выбрана единая модель данных `class WebLarekModel`

#### Класс WebLarekModel

Класс отвечает за хранение и логику работы с данными товаров, заказа, корзины.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:

- `basket`: {`items: IProductItem[]` - массив объектов товаров, `total: number` - сумма товров} - объект корзины товаров
- `catalog`: `IProductItem[]` - массив объектов товаров
- `order`: `Pick<TOrder, 'address' | 'payment'>` - объект данных заказа
- `contacts: Pick<TOrder, 'email' | 'phone'>` - объект данных контактов\
- `selectedItem`: `string | undefined` - `id` товара, выбранный для просмотра в модальном окне
- `events`: `IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.

- `setCatalog(data: IProductItem[]): void` - устанавливает массив объектов товара
- `getCatalog(): IProductItem[]` - возвращает массив объектов товара
- `getBasket(): IProductItem[]` - возвращает массив объектов товара находящихся в корзине\
- `getItem(id: string): IProductItem` - возвращает объект одного товара
- `selectItem(id: string): void` - устанавливает `id` выбранного товара
- `getSelectedItem(): string` - возвращает `id` выбранного товара
- `setPaymentOption(option: TPaymentOption): void` - устанавливает вариант оплаты
- `getPaymentOption(): TPaymentOption` - получает вариант оплаты
- `setOrderContact(name: TOrderField, value: string)` - устанавливает значения данных заказа введенные пользователем\
- `isDatasValid(obj: Partial<TOrder>)` - проверяет заполненость полей у переданного объекта\
- `getOrder(): void` - возвращает объект order
- `getContacts(): void` - возвращает объект contacts
- `getFinalOrder(): IOrder` - возвращает итоговый объект заказа для отправки\

- `addItemInBasket(id: string): void` - добавляет товар в корзину
- `removeItemFromBasket(id: string): void` - удаляет товар из корзины
- `isItemInBasket(id: string): string | undefined` - проверяет наличие конкретного товара в корзине
- `calculateBasketPrice(): void` - считает сумму товаров в корзине
- `getBasketCountItems(): number` - получает кол-во товаров в корзине
- `clearBasketData(): void` - очищает данные корзины
- `clearOrderData(): void` - очищает данные заказа
- `validateDatas(): Record<string, string>` - очищает данные заказа
  так же в классе присутствуют сеттеры и геттеры установки корзины `items` и общей цены товаров `basketTotal` находящихся в корзине.

### Отображение / View / Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component

Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Общее для всех классов представления

Практически все классы представления имеющие `constructor` рализуют его так:

- `constructor(container: HTMLElement, events: IEvents)` Конструктор принимает элемент, по которому будут найдены элементы внутри данного контейнера и экземпляр класса `EventEmitter` для возможности инициации событий.

#### Класс Modal

Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели для закрытия модального окна по клику в оверлей и кнопку-крестик для закрытия попапа.

Поля класса

- `_closeButton: HTMLButtonElement` - кнопка модального окна
- `_content: HTMLElement` - содержимое модального окна
- `events: IEvents` - брокер событий

#### Класс Form

Реализует форму. Так же предоставляет расширенный метод `render` для проверки полей инпута на ошибки и установку их в разметку. Устанавливает слушатели на поля ввода, слушая событие `input` и слушатель на корневой контейнер формы, слушая событие `submit`. Использует метод `onChangeInput`, для получения пользовательского ввода. Имеет в наличие сеттеры для управления свойством `disabled` кнопки и `errors` для установки текста ошибки.

- `constructor(container: HTMLElement, events: IEvents)` помимо общего назначения добавляет слушатели события на элементы.

Поля класса

- `errorsContainer: HTMLElement` - контейнер для ошибки
- `submitButton: HTMLButtonElement` - кнопка отправки на форме

#### Класс Card

Базовая карточка товара. Реализует общие поля, методы, слушатели для разных отображений товара на странице, в модальном окне и корзине.

- `constructor(container: HTMLElement, events: IEvents, protected actions?: TActions)` помимо общего назначения принимает дополнительный параметр объект `actions`, в котором передается функция для слушателей событий: кнопки добавления/удаления товара в корзину, для контейнера карточки товара открывающейся в модальном окне для просмотра.

Поля класса:

- `_id: string` - `id` товара
- `cardTitle: HTMLElement` - название товара
- `cardButton: HTMLButtonElement` - кнопка на карточке товара
- `cardPrice: HTMLElement` - цена товара

Сеттеры для установки `id` и `title` карточки.

#### Класс ProductItemCard

Расширяет класс `Card`. Предназначен для реализации отображения карточки товара
добавленого в каталог товаров на главной странице и просмотра товара в модальном окне.

Поля класса:

- `cardCategory: HTMLElement` - категория товара
- `cardImage: HTMLElement` - изображение товара
- `cardDescription: HTMLElement` - описание товара

Сеттеры для установки `category`,`price`,`image`,`description`,`buttonText` карточки товара.

Методы класса:

- `replaceCls(value: string): void` - метод замены css класса категории карточки\
- `setCategoryCls(category: string): void` - метод определения категории\

#### Класс BasketItemCard

Расширяет класс `Card`. Предназначен для реализации отображения карточки товара
добавленого в корзину.

Поля класса:

- `productIdx: HTMLElement` - порядковый номер товара в корзине

Сеттеры для установки `price`, `total` карточки товара.

#### Класс Basket

Реализует корзину покупаемых товаров

- `constructor(container: HTMLElement, events: IEvents)` помимо общего назначения добавляет слушатели события на кнопку оформления товара.

Поля класса:

- `_list: HTMLElement` - каталог товаров в корзине
- `_total: HTMLElement` - цена товаров в корзине
- `_button: HTMLElement` - кнопка оформления заказа
- `basketTotal: number` - цена товаров в корзине, для определения доступности кнопки оформления заказа\

Сеттеры для установки `items` - массив товаров, `total` - цены товаров, `selected` - проверка на пустоту корзины и цены корзины отличную от `0`, карточки товара.

#### Класс Order

Расширяет класс `Form`. Предназначен для реализации отображения выбора способа оплаты заказа и получения адреса доставки заказа.

- `constructor(container: HTMLElement, events: IEvents, protected actions?: onClick: (name: string) => void)` помимо общего назначения принимает дополнительный параметр объект `actions`, в котором передается функция для слушателя событий кнопки следующего действия по заказу товара.

Поля класса:

- `buttons: HTMLButtonElement[] = []` - массив кнопок для выбора варианта оплаты
- `btnContainer: HTMLElement` - корневой элемент-контейнер для кнопок

Сеттер для установки адреса доставки заказа `address`.

Методы класса:

- `selectOption(name: string): void` - выбор варианта оплаты заказа
- `clearData(): void` - очистка данных выбора оплаты

#### Класс Contacts

Расширяет класс `Form`. Предназначен для реализации отображения формы контактов.

Сеттеры для установки контактов пользователя оформляющего заказ `phone`, `email`.

#### Класс Page

Используется для наполнения отображения главной страницы магазина.

- `constructor(container: HTMLElement, events: IEvents)` помимо общего назначения добавляет слушатель события на кнопку открытия модального окна с корзиной.

Поля класса:

- `catalogContaner: HTMLElement` - список товаров
- `basketCountElement: HTMLElement` - количество товаров в корзине
- `basketOpenButton: HTMLElement` - кнопка открытия корзины
- `wrapperElement: HTMLElement` - элемент для фиксации прокрутки при открытии модального окна

Сеттеры класса устанавливают:

- `catalog` - каталог товаров
- `loader` - лоадер
- `locked` - фиксация страницы
- `basketCount` - количество товаров в корзине

#### Класс Success

Реализует отоброжение подтверждения успешно оформленого заказа.

Поля класса:

- `info: HTMLElement` - информация об итоговой сумме заказа
- `button: HTMLButtonElement` - кнопка завершения заказа

Сеттер для установки итоговой суммы заказа `infoPrice`.

#### Класс Loader

Реализует визуальное ожидание ответа от сервера. Имеет два метода `showLoader` - показать лоадер, `hideLoader` - скрыть лоадер.

### Слой коммуникации

#### Класс WebLarekAPI

Наследуется от экземпляра класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов (Презентер / Presenter)

Роль презентера выбран `src/index.ts` файл, соединяющий данные и отображения
событийно-ориентированным-подоходом `СОП`.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\

_Список всех событий, которые могут генерироваться в системе:_\
_События изменения данных (генерируются классом моделями данных)_

- `items:change` - изменение массива товаров
- `model:item:select` - выбор товара для просмотра
- `model:item:add` - добавление товара в корзину
- `model:item:remove` - удаление товара из корзины
- `model:payment:select` - установка варианта оплаты

_События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)_

- `view:item:select` - выбора корточки товара для просмотра
- `view:item:add` - добавление товара в корзину
- `view:item:remove` - удаление товара из корзины
- `view:basket:open` - открытие модального окна с корзиной
- `view:basket:change` - изменение корзины
- `view:order:open` - открытие модального окна с формой заказа\
- `order:submit` - переход к оформлению контактов
- `^(contacts|order).*:change/` - установка значений введенных пользователем\
- `formErrors:change` - валидация значений введенных пользователем
- `contacts:submit` - отправка заказа на сервер
- `order:done` - успешное завершение заказа переход к новым покупкам
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
